---
// src/pages/projects/[slug].astro
import Layout from '../../layouts/Layout.astro';
import { getCollection, getEntry } from 'astro:content';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
    const projects = await getCollection('projects');
    return projects.map(project => ({
        params: {
            // Volvemos a usar `project.slug` que ahora se generará correctamente.
            slug: project.slug
        },
    }));
}

const { slug } = Astro.params;
const project = await getEntry('projects', slug);

if (!project) {
    return new Response(null, { status: 404, statusText: 'Not Found' });
}

const { Content } = await project.render();
---

<Layout title={project.data.title}>
    <article class="max-w-4xl mx-auto py-12 px-4">
        <a href="/" class="text-[var(--color-accent)] hover:underline mb-8 inline-block">&larr; Volver a todos los proyectos</a>

        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-[var(--color-accent)] to-purple-500">
            {project.data.title}
        </h1>

        <p class="text-lg text-[var(--color-text-muted)] mb-8">
            {project.data.description}
        </p>

        <div class="flex flex-wrap gap-2 mb-8">
            {project.data.tags.map((tag) => (
                    <span class="text-xs font-medium px-2.5 py-0.5 rounded-full bg-[var(--color-accent)]/10 text-[var(--color-accent)]">
                    {tag}
                </span>
            ))}
        </div>

        {project.data.image && (
                <div class="my-12 rounded-lg overflow-hidden border border-[var(--color-text-body)]/10">
                    <Image
                            src={project.data.image}
                            alt={`Diagrama de ${project.data.title}`}
                            width={1200}
                            height={600}
                            class="w-full h-auto object-cover"
                    />
                </div>
        )}

        <div class="prose prose-lg max-w-none prose-headings:text-[var(--color-text-body)] prose-p:text-[var(--color-text-muted)] prose-a:text-[var(--color-accent)]">
            <Content />
        </div>

        <div class="mt-12 pt-8 border-t border-[var(--color-text-body)]/10 flex items-center gap-6">
            {project.data.github && (
                    <a href={project.data.github} target="_blank" rel="noopener noreferrer" class="text-[var(--color-accent)] hover:underline font-medium">
                        Ver Código en GitHub
                    </a>
            )}
            {project.data.link && (
                    <a href={project.data.link} target="_blank" rel="noopener noreferrer" class="text-[var(--color-accent)] hover:underline font-medium">
                        Ver Demo en Vivo
                    </a>
            )}
        </div>
    </article>
</Layout>
